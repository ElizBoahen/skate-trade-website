/*!CK:3648461380!*//*1438614782,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["rBihR"]); }

__d("legacy:AggregatedMap",["AggregatedMap","AggregatedMapCalloutOrientation"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.AggregatedMap=b('AggregatedMap');a.AggregatedMapCalloutOrientation=b('AggregatedMapCalloutOrientation');},3);
__d("TilesDynamicMap",["Arbiter","ArbiterMixin","DataStore","DOM","Event","GeoCoordinates","leaflet","LeafletUtils","LeafletView","MapsReporterLogger","Parent","TilesMapConfig","TilesMapUtils","csx","cx","mod","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();var x=w(h);for(var y in x)if(x.hasOwnProperty(y))aa[y]=x[y];var z=x===null?null:x.prototype;aa.prototype=Object.create(z);aa.prototype.constructor=aa;aa.__superConstructor__=x;function aa(ca,da,ea,fa,ga,ha,ia){"use strict";x.call(this);this.map=m.map(ca,{center:[fa.latitude,fa.longitude],zoom:fa.zoom||1,layers:[m.tileLayer(fa.urlTemplate||s.getTileURLTemplate(fa.language),{minZoom:1,maxZoom:18})],zoomControl:fa.zoomControl,attributionControl:false}).on({click:function(bb){this.inform('DynamicMap/mapClick',{lat:bb.latlng.lat,lng:bb.latlng.lng},g.BEHAVIOR_PERSISTENT);}.bind(this)});var ja=r.OSM_RECTS_RAW;this.osmBounds=ja.map(function(bb){return m.latLngBounds([bb[2],bb[1]],[bb[0],bb[3]]);});this.osmZoomThreshold=r.OSM_ZOOM_THRESHOLD;for(var ka=0;ka<ga.length;ka++){var la=ga[ka],ma=m.icon({iconUrl:la.iconUrl,iconRetinaUrl:la.iconRetinaUrl,iconSize:la.iconSize,iconAnchor:la.iconAnchor,popupAnchor:la.popupAnchor}),na=m.marker([la.latitude,la.longitude],{draggable:la.draggable,icon:ma}).on('drag',function(bb){var cb=bb.target.getLatLng();g.inform('DynamicMap/pinDrag',{pin_id:ka,latitude:cb.lat,longitude:cb.lng},g.BEHAVIOR_PERSISTENT);});if(la.popupContent!=null){var oa={};if(la.popupMaxWidth!=null)oa.maxWidth=la.popupMaxWidth;if(la.popupMaxHeight!=null)oa.maxHeight=la.popupMaxHeight;na.bindPopup(m.popup(oa).setContent(la.popupContent));}na.addTo(this.map);}this.polys={};for(ka=0;ka<ha.length;ka++){var pa=ha[ka].points.map(function(bb){return [parseFloat(bb.latitude),parseFloat(bb.longitude)];}),qa={stroke:(ha[ka].weight>0)?true:false,weight:ha[ka].weight,color:ha[ka].color,opacity:ha[ka].opacity,fillColor:ha[ka].fillColor,fillOpacity:ha[ka].fillOpacity},ra=null;if(ha[ka].type=='polyline'){ra=m.polyline(pa,qa);}else if(ha[ka].type=='polygon')ra=m.polygon(pa,qa);if(ha[ka].activeFillColor){var sa=ha[ka].fillColor,ta=ha[ka].fillOpacity,ua=ha[ka].activeFillColor,va=ha[ka].activeFillOpacity;ra.on({mouseover:function(bb){bb.target.setStyle({fillColor:ua,fillOpacity:va});}.bind(this),mouseout:function(bb){bb.target.setStyle({fillColor:sa,fillOpacity:ta});}.bind(this)});}if('id' in ha[ka]){ra.id=ha[ka].id;this.polys[ra.id]=ra;}ra.on({mouseover:function(bb){this.inform('DynamicMap/polyMouseOver',{target:bb.target},g.BEHAVIOR_PERSISTENT);}.bind(this),mouseout:function(bb){this.inform('DynamicMap/polyMouseOut',{target:bb.target},g.BEHAVIOR_PERSISTENT);}.bind(this),click:function(bb){this.inform('DynamicMap/polyClick',{target:bb.target},g.BEHAVIOR_PERSISTENT);}.bind(this)});ra.addTo(this.map);}this.circles={};for(ka=0;ka<ia.length;ka++){var wa=m.circle([ia[ka].latitude,ia[ka].longitude],ia[ka].radius,{color:ia[ka].color,weight:ia[ka].weight,opacity:ia[ka].opacity,fillColor:ia[ka].fillColor,fillOpacity:ia[ka].fillOpacity}).addTo(this.map),xa=('id' in ia[ka])?'id:'+ia[ka].id:ka;this.circles[xa]=wa;}this.subscribe('DynamicMap/setRadius',function(bb,cb){var db=null;if('id' in cb){db=this.circles['id:'+cb.id];}else{var eb=Object.keys(this.circles);if(eb.length==1)db=this.circles[eb[0]];}if(db){db.setRadius(cb.radius);if(cb.center)this.map.fitBounds(db.getBounds());}}.bind(this));var ya=this,za=m.Control.extend({options:{position:'bottomleft'},initialize:function(bb){m.Util.setOptions(this,bb);},onAdd:function(bb){var cb=m.DomUtil.create('div',null,this.$TilesDynamicMap0);this.hereLogo=m.DomUtil.create('img',null,cb);this.osmCopyright=m.DomUtil.create('span',"_3q1-",cb);j.setContent(this.osmCopyright,'\u00A9 OpenStreetMap');var db=r.LOGO;this.hereLogo.src=db.url;this.hereLogo.width=db.width;this.hereLogo.height=db.height;bb.on('resize',function(eb){ya.$TilesDynamicMap1(eb.newSize,this);},this);ya.$TilesDynamicMap1({newSize:bb.getSize()},this);return cb;}}),ab=new za();this.map.on('moveend',function(){this.$TilesDynamicMap1(this.map.getSize(),ab);},this);this.map.addControl(ab);if(r.IS_REPORT_BUTTON_ENABLED)this.$TilesDynamicMap2(da,ea);i.set(ca,'TilesDynamicMap',this);this.inform('DynamicMap/onInit',{},g.BEHAVIOR_PERSISTENT);}aa.prototype.on=function(ca,da){"use strict";this.map.on(ca,da);};aa.prototype.off=function(ca,da){"use strict";this.map.off(ca,da);};aa.prototype.fitBounds=function(ca){"use strict";this.map.fitBounds(ca);};aa.prototype.getCenter=function(){"use strict";var ca=this.map.getCenter();return {latitude:ca.lat,longitude:ca.lng};};aa.prototype.getZoom=function(){"use strict";return this.map.getZoom();};aa.prototype.getWidth=function(){"use strict";return this.map.getSize().x;};aa.prototype.getHeight=function(){"use strict";return this.map.getSize().y;};aa.prototype.invalidateSize=function(){"use strict";this.map.invalidateSize(false);};aa.prototype.setView=function(ca){"use strict";if(ca.centerOffset){var da=this.map.project(ca.center,ca.zoom);da=da.subtract(ca.centerOffset);ca.center=this.map.unproject(da,ca.zoom);}this.map.setView(ca.center,ca.zoom,{animate:ca.animate});this.map.fireEvent('movestart');this.map.fireEvent('moveend');};aa.prototype.poly=function(ca){"use strict";return this.polys[ca];};aa.prototype.onInit=function(ca){"use strict";ca();};aa.prototype.getMicrosoftMaps=function(){"use strict";return new ba(this);};aa.prototype.getMap=function(){"use strict";return this;};aa.prototype.mapToPixel=function(ca){"use strict";var da=this.map.getPixelBounds().min;return ca.sub(da.x,da.y);};aa.prototype.pixelToMap=function(ca){"use strict";var da=this.map.getPixelBounds().min,ea=ca.add(da.x,da.y);ea.x=v(ea.x,this.$TilesDynamicMap3());return ea;};aa.prototype.tryPixelToLocation=function(ca){"use strict";return this.map.containerPointToLatLng(ca);};aa.prototype.$TilesDynamicMap3=function(){"use strict";return 512*Math.pow(2,this.map.getZoom()-1);};aa.prototype.$TilesDynamicMap1=function(ca,da){"use strict";if(ca.x<r.MIN_SIZE_FOR_ATTRIBUTION||ca.y<r.MIN_SIZE_FOR_ATTRIBUTION){da.hereLogo.hidden=true;da.osmCopyright.hidden=true;}else{da.hereLogo.hidden=this.$TilesDynamicMap4();da.osmCopyright.hidden=!da.hereLogo.hidden;}};aa.prototype.$TilesDynamicMap4=function(){"use strict";if(this.map.getZoom()<this.osmZoomThreshold)return false;var ca=this.map.getSize();return n.isViewInBounds(new o({center:n.fromLatLng(this.map.getCenter()),zoom:this.map.getZoom()}),{width:ca.x,height:ca.y},this.osmBounds);};aa.prototype.$TilesDynamicMap2=function(ca,da){"use strict";var ea=m.Control.extend({options:{position:'bottomright'},reportButton:ca,initialize:function(ga){m.Util.setOptions(this,ga);},onAdd:function(ga){da.subscribe('cancel',function(){p.logConfirmDialogClick(p.ACTION_DIALOG_CANCEL,p.MAP_RENDERER_TYPE_DYNAMIC_MAP);});da.subscribe('button',function(){var ha=ga.getCenter(),ia=new o({center:new l(ha.lat,ha.lng),zoom:ga.getZoom()}),ja=s.getMapProviderForReportButton(ia);p.logConfirmDialogClick(p.ACTION_DIALOG_OPEN_MAPS_REPORTER,p.MAP_RENDERER_TYPE_DYNAMIC_MAP);window.open(s.getReporterToolUrl(ja,ia),'_blank');da.hide();});k.listen(this.reportButton,'click',function(){p.logReportButtonClick(p.ACTION_OPEN_CONFIRM_DIALOG,p.MAP_RENDERER_TYPE_DYNAMIC_MAP);da.show();});return this.reportButton;}}),fa=new ea();this.map.addControl(fa);};aa.getInstance=function(ca){"use strict";var da=q.byClass(ca,"_49nx");if(!da){var ea=j.scry(ca,"._49nx");da=ea.length>0?ea[0]:null;}return da?i.get(da,'TilesDynamicMap'):null;};aa.poke=function(ca){"use strict";var da=aa.getInstance(ca);da&&da.invalidateSize();};function ba(ca){"use strict";this.map=ca;this.Events={addHandler:function(da,ea,fa){if(ea==='viewchange'){ea='movestart move';}else if(ea==='viewchangeend')ea='moveend';var ga=function(ha){fa({getX:function(){return ha.containerPoint.x;},getY:function(){return ha.containerPoint.y;}});};da.on(ea,ga);return {map:da,evt:ea,fn:ga};},removeHandler:function(da){da.map.off(da.evt,da.fn);}};this.Point=m.point;this.Location=m.LatLng;this.PixelReference={control:null};}e.exports=aa;},null);