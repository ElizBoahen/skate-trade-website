/*!CK:3219070943!*//*1438572769,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gc5Dc"]); }

__d("ReactComposerPhotoUploader",["ReactComposerLoggingStore","ReactComposerMediaConfig","ReactComposerPhotoActions","ReactComposerPhotoUploadActions","ReactComposerPhotoUploadStore","ActorURI","AsyncUploadRequest","FaceRecognitionController","JpegResizer","Map","XComposerPhotoUploader","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';function s(t,u,v){this.$ReactComposerPhotoUploader0=t;var w=h.photo,x=null;if(o.isSupported()){x=o.getSingleton(u>1?o.DEFAULT_POOL_SIZE:1);x.setHighQuality(w.highQuality);}else j.resizerUnavailable(this.$ReactComposerPhotoUploader0);var y=l.create(w.uploadEndpoint,v);this.$ReactComposerPhotoUploader1=new q({uploadEndpoint:y,uploadData:Object.assign({qn:g.getSessionID(t)},w.uploadData),retryLimit:w.retryLimit,concurrentLimit:w.concurrentLimit,resizer:x,onUploadEnqueued:this.$ReactComposerPhotoUploader2.bind(this),onResizeStart:this.$ReactComposerPhotoUploader3.bind(this),onResizeSuccess:this.$ReactComposerPhotoUploader4.bind(this),onResizeFailure:this.$ReactComposerPhotoUploader5.bind(this),onResizeProgress:this.$ReactComposerPhotoUploader6.bind(this),onUploadStart:this.$ReactComposerPhotoUploader7.bind(this),onUploadProgress:this.$ReactComposerPhotoUploader8.bind(this),onUploadSuccess:this.$ReactComposerPhotoUploader9.bind(this),onUploadFailure:this.$ReactComposerPhotoUploadera.bind(this)});this.$ReactComposerPhotoUploaderb=new n({include_unrecognized_faceboxes:true,include_low_confidence_recognitions:true,include_face_crop_src:true});this.$ReactComposerPhotoUploaderb.subscribe('photo',this.$ReactComposerPhotoUploaderc.bind(this)),this.$ReactComposerPhotoUploaderb.subscribe('done',this.$ReactComposerPhotoUploaderd.bind(this));this.$ReactComposerPhotoUploadere=new p();}s.prototype.upload=function(t){this.$ReactComposerPhotoUploader1.upload(t);};s.prototype.retry=function(t){var u=this.$ReactComposerPhotoUploader1.getAsyncUploadRequest([t]);u.send();};s.prototype.getAsyncUploadRequest=function(t,u){return this.$ReactComposerPhotoUploader1.getAsyncUploadRequest(t,u);};s.prototype.enqueueAsyncUploadRequest=function(t,u,v){u.forEach(function(w){var x=v.indexMap?v.indexMap.get(w.uploadID):k.getUploads(t).size;j.enqueue(t,w.uploadID,w.filename,x);});this.getAsyncUploadRequest(u,v).send();};s.prototype.isUploadLimitExceeded=function(t,u){var v=this.getMaxSelectableFilesCount(t),w=!u||!m.isSupported()?1:u.length;return w>v;};s.prototype.getMaxSelectableFilesCount=function(t){return !!t?h.photo.limit:1;};s.prototype.$ReactComposerPhotoUploader2=function(t){j.enqueue(this.$ReactComposerPhotoUploader0,t.uploadID,t.fileName,k.getUploads(this.$ReactComposerPhotoUploader0).size);};s.prototype.$ReactComposerPhotoUploader3=function(t){j.startResizing(this.$ReactComposerPhotoUploader0,t.uploadID,{bytes:t.size});};s.prototype.$ReactComposerPhotoUploader6=function(t,event){setTimeout(function(){return j.progressResizing(this.$ReactComposerPhotoUploader0,t,100*event.written/event.total);}.bind(this),0);};s.prototype.$ReactComposerPhotoUploader4=function(t,u,v,w){j.doneResizing(this.$ReactComposerPhotoUploader0,t.uploadID,{dt:w,media_data_size:t.size,bytes:u.size,custom_tags:{skipped_resizing:v}});};s.prototype.$ReactComposerPhotoUploader5=function(t,u,v,w){j.failResizing(this.$ReactComposerPhotoUploader0,t.uploadID,{dt:w,bytes:t.size,error_code:v.code,error_info:v.message});};s.prototype.$ReactComposerPhotoUploader7=function(t,u){j.startUploading(this.$ReactComposerPhotoUploader0,t,u.upload);this.$ReactComposerPhotoUploadere.set(t,r());};s.prototype.$ReactComposerPhotoUploader8=function(t,u){setTimeout(function(){return j.progressUploading(this.$ReactComposerPhotoUploader0,t,100*u.event.loaded/u.event.total);}.bind(this),0);};s.prototype.$ReactComposerPhotoUploader9=function(t,u){if(k.getHasUploadBeenRemoved(this.$ReactComposerPhotoUploader0,t))return;var v=u.response.payload;j.doneUploading(this.$ReactComposerPhotoUploader0,t,u.upload,r()-this.$ReactComposerPhotoUploadere.get(t),v.photoID,v.thumbSrc,v.originalPhotoID);i.startRecognizing(this.$ReactComposerPhotoUploader0,v.photoID);this.$ReactComposerPhotoUploaderb.start([v.photoID]);};s.prototype.$ReactComposerPhotoUploadera=function(t,u,v){if(k.getHasUploadBeenRemoved(this.$ReactComposerPhotoUploader0,t))return;var w=u.response,x={code:w.getError(),description:w.getErrorDescription(),summary:w.getErrorSummary(),transient:w.isTransient()||w.getError()==1004||w.getError()==1006};j.failUploading(this.$ReactComposerPhotoUploader0,t,u.upload,r()-this.$ReactComposerPhotoUploadere.get(t),x);};s.prototype.$ReactComposerPhotoUploaderc=function(t,u){u.faceboxes.forEach(function(v){var w;if(v.recognitions.length>0){var x=v.recognitions[0].user;w={subjectID:x.fbid,value:x.name};}i.addFacebox(this.$ReactComposerPhotoUploader0,u.photo,{id:v.fbid,x:v.x,y:v.y,top:v.top,left:v.left,width:v.width,height:v.height,croppedURI:v.src,bestRecognition:w,allRecognitions:v.allRecognitions});}.bind(this));i.finishRecognizingPhoto(this.$ReactComposerPhotoUploader0,u.photo);};s.prototype.$ReactComposerPhotoUploaderd=function(t,u){i.finishRecognizing(this.$ReactComposerPhotoUploader0,u.unresolved);};e.exports=s;},null);